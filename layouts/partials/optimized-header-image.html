{{/* Optimoitu header-kuva responsivisella WebP-tuella ja preloadauksella */}}
{{- $image := .image }}
{{- $alt := .alt | default "Icetribe header image" }}
{{- $sizes := .sizes | default "100vw" }}

{{- if $image }}
  {{- $imagePath := $image }}
  {{- if hasPrefix $image "/" }}
    {{- $imagePath = strings.TrimPrefix "/" $image }}
  {{- end }}
  
  {{- with resources.Get $imagePath }}
    {{/* Luo responsiiviset koot */}}
    {{- $small := .Resize "800x webp q85" }}
    {{- $medium := .Resize "1200x webp q85" }}
    {{- $large := .Resize "1600x webp q85" }}
    {{- $xlarge := .Resize "2000x webp q85" }}
    
    {{/* Fallback JPEG-kuvat */}}
    {{- $smallJpg := .Resize "800x jpg q80" }}
    {{- $mediumJpg := .Resize "1200x jpg q80" }}
    {{- $largeJpg := .Resize "1600x jpg q80" }}
    
    <picture>
      <!-- WebP format for modern browsers -->
      <source type="image/webp" 
              sizes="{{ $sizes }}"
              srcset="{{ $small.RelPermalink }} 800w,
                      {{ $medium.RelPermalink }} 1200w,
                      {{ $large.RelPermalink }} 1600w,
                      {{ $xlarge.RelPermalink }} 2000w">
      
      <!-- JPEG fallback -->
      <source type="image/jpeg" 
              sizes="{{ $sizes }}"
              srcset="{{ $smallJpg.RelPermalink }} 800w,
                      {{ $mediumJpg.RelPermalink }} 1200w,
                      {{ $largeJpg.RelPermalink }} 1600w">
      
      <!-- Default image -->
      <img src="{{ $medium.RelPermalink }}" 
           alt="{{ $alt }}" 
           loading="eager"
           decoding="async"
           style="width: 100%; height: 100%; object-fit: cover;">
    </picture>
  {{- else }}
    {{/* Fallback static-kuville */}}
    <img src="{{ $image }}" 
         alt="{{ $alt }}" 
         loading="eager"
         decoding="async"
         style="width: 100%; height: 100%; object-fit: cover;">
  {{- end }}
{{- end }}