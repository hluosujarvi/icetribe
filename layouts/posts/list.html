{{ define "header" }}
  {{ $featured_image := partials.Include "func/GetFeaturedImage.html" . }}
  {{ if $featured_image }}
    {{/* Trimming the slash and adding absURL make sure the image works no matter where our site lives */}}
    {{ $featured_image_class := .Params.featured_image_class | compare.Default "cover bg-center" }}
    <header class="{{ $featured_image_class }}" style="background-image: url('{{ $featured_image }}');">
      {{ $cover_dimming_class := .Params.cover_dimming_class | compare.Default "bg-black-60" }}
      <div class="{{ $cover_dimming_class }}">
        {{ partials.Include "site-navigation.html" .}}
        <div class="tc-l pv6 ph3 ph4-ns">
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">{{ .Title | compare.Default .Site.Title }}</div>
          {{ with .Params.description }}
            <div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              {{ . }}
            </div>
          {{ end }}
        </div>
      </div>
    </header>
  {{ else }}
    <header>
      <div class="pb3-m pb6-l {{ .Site.Params.background_color_class | compare.Default "bg-black" }}">
        {{ partials.Include "site-navigation.html" . }}
        <div class="tc-l pv3 ph3 ph4-ns">
          <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
            {{ .Title | compare.Default .Site.Title }}
          </h1>
          {{ with .Params.description }}
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              {{ . }}
            </h2>
          {{ end }}
        </div>
      </div>
    </header>
  {{ end }}
{{ end }}

{{ define "main" }}
  {{ $page := .}}
  {{ $section := .Site.GetPage "section" .Section }}
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
        {{/*
        CurrentSection allows us to use the section title instead of inferring from the folder.
        https://gohugo.io/variables/page/#section-variables-and-methods
        */}}
        {{ .CurrentSection.Title }}
      </aside>
      <h1 class="f1 athelas mt3 mb1">
        {{- .Site.Title -}}
      </h1>
    </header>
    <div class="nested-copy-line-height lh-copy {{ $.Param "post_content_classes"  | compare.Default "serif"}} f4 nested-links {{ $.Param "text_color" | compare.Default "mid-gray" }} {{ compare.Conditional (compare.Eq $.Site.Language.LanguageDirection "rtl") "pl4-l" "pr4-l" }} w-two-thirds-l">
      {{- .Content -}}
    </div>

    <aside class="w-30-l mt6-l">
      {{- partials.Include "menu-contextual.html" . -}}
    </aside>
  </article>
  
  {{/* Mukautettu posts-lista */}}
  <section class="w-100 center ph3 ph4-ns">
    <div class="mw7 center mt5">
      {{ range .Paginator.Pages }}
        <div class="w-100 mb4 relative bg-white shadow-4 br3 overflow-hidden flex">
          {{/* Featured image jos löytyy - puolet kortista */}}
          {{ $featured_image := partials.Include "func/GetFeaturedImage.html" . }}
          {{ if $featured_image }}
            <div class="w-50 h5 bg-center cover" style="background-image: url('{{ $featured_image }}');"></div>
          {{ end }}
          
          {{/* Sisältö - puolet kortista */}}
          <div class="w-50 pa4 flex flex-column justify-between">
            {{/* Otsikko */}}
            <div>
              <h2 class="f4 f3-l fw6 lh-title mb3 mt0">
                <a href="{{ .RelPermalink }}" class="link black hover-dark-gray">
                  {{ .Title }}
                </a>
              </h2>
            </div>
            
            {{/* Alaosa: päivämäärä, tagit ja nappi */}}
            <div>
              {{/* Päivämäärä ja tagit */}}
              <div class="f6 gray mb3 flex items-center justify-between">
                <time>{{ .Date.Format "2.1.2006" }}</time>
                {{ if .Params.tags }}
                  <div>
                    {{ range first 3 .Params.tags }}
                      <span class="bg-light-gray ph2 pv1 br2 mr1 f7">{{ . }}</span>
                    {{ end }}
                  </div>
                {{ end }}
              </div>
              
              {{/* Lue lisää -nappi */}}
              <a href="{{ .RelPermalink }}" class="f6 link dim br2 ph3 pv2 mb2 dib white bg-dark-gray hover-bg-black">
                {{ $.Site.Params.read_more_copy | default "Lue lisää" }}
              </a>
            </div>
          </div>
        </div>
      {{ end }}
    </div>
    
    {{/* Pagination */}}
    <div class="tc mt5">
      {{- template "_internal/pagination.html" . -}}
    </div>
  </section>
{{ end }}