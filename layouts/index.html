{{ define "header" }}
  {{ $featured_image := partials.Include "func/GetFeaturedImage.html" . }}
  {{ if $featured_image }}
    {{ $featured_image_rel := replaceRE "^https?://[^/]+" "" $featured_image }}
    {{ $featured_image_class := site.Params.featured_image_class | compare.Default "cover bg-center" }}
    <header class="{{ $featured_image_class }}" style="background-image: url('{{ $featured_image_rel }}'); min-height: 60vh;">
      {{ $cover_dimming_class := site.Params.cover_dimming_class | compare.Default "bg-black-60" }}
      <div class="{{ $cover_dimming_class }}" style="min-height: 60vh;">
        {{/* Increased header height for homepage: much larger padding for dramatic effect */}}
        <div class="tc-l ph3 ph4-ns" style="padding-top: 6rem; padding-bottom: 6rem;">
          <h1 class="f2 f-subheadline-l fw2 white-90 mb0 lh-title">
            {{ .Title | compare.Default .Site.Title }}
          </h1>
          {{ with .Params.description }}
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center mt3">
              {{ . }}
            </h2>
          {{ end }}
        </div>
      </div>
    </header>
  {{ else }}
    <header>
      <div class="pb3-m pb6-l {{ .Site.Params.background_color_class | compare.Default "bg-black" }}">
        {{/* Increased header height for homepage: custom padding for dramatic effect */}}
        <div class="tc-l ph3 ph4-ns" style="padding-top: 4rem; padding-bottom: 4rem;">
          <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
            {{ .Title | compare.Default .Site.Title }}
          </h1>
          {{ with .Params.description }}
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              {{ . }}
            </h2>
          {{ end }}
        </div>
      </div>
    </header>
  {{ end }}
{{ end }}

{{ define "main" }}
  {{/* Responsiivinen layout: desktop kaksi palstaa, mobile yksi palsta */}}
  <div class="flex-l mw8 center ph3 ph4-ns pv4 items-start">
    
    {{/* Pääsisältö vasemmalla - desktop 55%, mobile 100% */}}
    <article class="homepage-content w-100 w-55-l {{ compare.Conditional (compare.Eq $.Site.Language.LanguageDirection "rtl") "pl4-l" "pr4-l" }} mb4">
      <div class="f4 lh-copy nested-links {{ $.Param "text_color" | compare.Default "mid-gray" }}">
        {{ .Content }}
      </div>

      {{ $band := site.Params.band }}
      <section class="homepage-cta bg-white shadow-4 br3 pa4 mt4" aria-labelledby="booking-cta">
        <h2 id="booking-cta" class="f3 fw6 mb3 dark-gray">
          {{ with $band.cta_title }}{{ . }}{{ else }}Tilaa Icetribe tapahtumaasi{{ end }}
        </h2>
        <p class="f5 lh-copy mb3">
          {{ with $band.cta_intro }}{{ . }}{{ else }}Autamme sinua rakentamaan unohtumattoman tapahtuman seitsemän vuosikymmenen hittikimaralla.{{ end }}
        </p>

        {{ with $band.highlights }}
          <ul class="list pl0 mb3" aria-label="Miksi valita Icetribe">
            {{ range . }}
              <li class="homepage-cta-point mb2">{{ . }}</li>
            {{ end }}
          </ul>
        {{ end }}

        <div class="flex flex-column flex-row-ns items-start">
          <a href="/yhteystiedot/" class="homepage-cta-button f6 link dim br2 ph3 pv2 dib white bg-dark-gray hover-bg-black">
            {{ with $band.cta_button_text }}{{ . }}{{ else }}Ota yhteyttä{{ end }}
          </a>
        </div>
      </section>

      {{ partial "home/testimonials.html" . }}
    </article>

    {{/* Sivupalkki oikealla - desktop 40%, mobile 100% */}}
    <aside class="homepage-sidebar w-100 w-40-l {{ compare.Conditional (compare.Eq $.Site.Language.LanguageDirection "rtl") "pr3-l" "pl3-l" }}">
      {{/* Hae kolme uusinta postausta */}}
      {{ $posts := collections.Where .Site.RegularPages "Section" "posts" }}
      {{ if $posts }}
        {{/* Kehys korteille */}}
        <div class="bg-white shadow-4 br3 pa3 ba b--light-gray">
          <h3 class="f4 fw6 mb3 mt0 dark-gray">Tuoreimmat kuulumiset</h3>
          
          {{ range collections.First 3 $posts }}
            <div class="w-100 mb4 relative bg-white shadow-4 br3 overflow-hidden">
              {{/* Featured image jos löytyy - täysi leveys */}}
              {{ $featured_image := partials.Include "func/GetFeaturedImage.html" . }}
              {{ if $featured_image }}
                <div class="h4 bg-center cover" style="background-image: url('{{ $featured_image }}');"></div>
              {{ end }}
              
              {{/* Sisältö - täysi leveys */}}
              <div class="pa3">
                {{/* Otsikko */}}
                <h2 class="f5 fw6 lh-title mb2 mt0">
                  <a href="{{ .RelPermalink }}" class="link black hover-dark-gray">
                    {{ .Title }}
                  </a>
                </h2>
                
                {{/* Päivämäärä ja tagit */}}
                <div class="f6 gray mb2 flex items-center justify-between">
                  <time>{{ .Date.Format "2.1.2006" }}</time>
                  {{ if .Params.tags }}
                    <div>
                      {{ range first 2 .Params.tags }}
                        <span class="bg-light-gray ph2 pv1 br2 mr1 f7">{{ . }}</span>
                      {{ end }}
                    </div>
                  {{ end }}
                </div>
                
                {{/* Lue lisää -nappi */}}
                <a href="{{ .RelPermalink }}" class="f6 link dim br2 ph2 pv1 dib white bg-dark-gray hover-bg-black">
                  {{ $.Site.Params.read_more_copy | default "Lue lisää" }}
                </a>
              </div>
            </div>
          {{ end }}
          
          {{/* Linkki kaikkiin kuulumisiin */}}
          <div class="tc mt3">
            <a href="/posts/" class="f6 link dim br2 ph3 pv2 dib black bg-white hover-bg-light-gray ba b--light-gray">
              Kaikki kuulumiset →
            </a>
          </div>
        </div>
      {{ end }}
    </aside>
  </div>
{{ end }}